---
layout: default
title: "ê²€ìƒ‰"
permalink: /search/
---

<div class="content-area">
    <div class="search-page">
        <header class="search-header">
            <h1>ê²Œì‹œë¬¼ ê²€ìƒ‰</h1>
            <div class="search-box">
                <input type="text" id="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off">
                <button id="search-button" aria-label="ê²€ìƒ‰">ğŸ”</button>
            </div>
        </header>

        <div id="search-results" class="search-results">
            <div id="loading" class="search-loading" style="display: none;">
                ê²€ìƒ‰ ì¤‘...
            </div>
            
            <div id="no-results" class="no-results" style="display: none;">
                <h3>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</p>
            </div>
            
            <div id="results-container" class="results-container">
                <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>
</div>

<!-- ì‚¬ì´ë“œë°” (ì¹´í…Œê³ ë¦¬ë§Œ) -->
<aside class="sidebar slide-in">
    <div class="sidebar-section">
        <h3 class="sidebar-title">ì¹´í…Œê³ ë¦¬</h3>
        <div class="categories-list">
            {% for category in site.categories %}
            <div class="category-item">
                <a href="{{ '/categories/' | append: category[0] | relative_url }}" class="category-link">{{ category[0] }}</a>
                <span class="category-count">{{ category[1].size }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
</aside>

<!-- í¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ìƒì„± -->
<script id="posts-data" type="application/json">
[
{% for post in site.posts %}
{
    "title": {{ post.title | jsonify }},
    "url": {{ post.url | jsonify }},
    "excerpt": {{ post.excerpt | strip_html | jsonify }},
    "content": {{ post.content | strip_html | truncatewords: 100 | jsonify }},
    "category": {{ post.category | jsonify }},
    "tags": {{ post.tags | jsonify }},
    "date": {{ post.date | date: "%Yë…„ %mì›” %dì¼" | jsonify }}
}{% unless forloop.last %},{% endunless %}
{% endfor %}
]
</script>

<script>
// í¬ìŠ¤íŠ¸ ë°ì´í„° ë¡œë“œ
const postsData = JSON.parse(document.getElementById('posts-data').textContent);

// URLì—ì„œ ê²€ìƒ‰ì–´ ì¶”ì¶œ
function getSearchQuery() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('q') || '';
}

// ê²€ìƒ‰ ì‹¤í–‰
function performSearch(query) {
    const resultsContainer = document.getElementById('results-container');
    const noResults = document.getElementById('no-results');
    const loading = document.getElementById('loading');
    
    if (!query.trim()) {
        resultsContainer.innerHTML = '';
        noResults.style.display = 'none';
        return;
    }

    loading.style.display = 'block';
    
    const keywords = query.toLowerCase().split(' ').filter(k => k.length > 0);
    const results = [];

    postsData.forEach(post => {
        let score = 0;
        const titleLower = post.title.toLowerCase();
        const contentLower = post.content.toLowerCase();
        const categoryLower = post.category.toLowerCase();
        const tagsLower = post.tags.map(tag => tag.toLowerCase());

        keywords.forEach(keyword => {
            // ì œëª©ì—ì„œ ì°¾ê¸° (ê°€ì¤‘ì¹˜ ë†’ìŒ)
            if (titleLower.includes(keyword)) score += 10;
            
            // ì¹´í…Œê³ ë¦¬ì—ì„œ ì°¾ê¸°
            if (categoryLower.includes(keyword)) score += 7;
            
            // íƒœê·¸ì—ì„œ ì°¾ê¸°
            tagsLower.forEach(tag => {
                if (tag.includes(keyword)) score += 5;
            });
            
            // ë‚´ìš©ì—ì„œ ì°¾ê¸°
            if (contentLower.includes(keyword)) score += 1;
        });

        if (score > 0) {
            results.push({ post, score });
        }
    });

    results.sort((a, b) => b.score - a.score);
    
    setTimeout(() => {
        loading.style.display = 'none';
        displayResults(results, query);
    }, 300);
}

// ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
function displayResults(results, query) {
    const container = document.getElementById('results-container');
    const noResults = document.getElementById('no-results');

    if (results.length === 0) {
        container.innerHTML = '';
        noResults.style.display = 'block';
        return;
    }

    noResults.style.display = 'none';
    
    const html = `
        <div class="results-count">
            <strong>${results.length}ê°œ</strong>ì˜ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.
        </div>
        ${results.map(({ post }) => `
            <article class="search-result-item">
                <div class="search-result-meta">
                    <span class="search-result-date">${post.date}</span>
                    <span class="search-result-category">${post.category}</span>
                </div>
                <h3 class="search-result-title">
                    <a href="${post.url}">${highlightText(post.title, query)}</a>
                </h3>
                <p class="search-result-excerpt">${highlightText(post.excerpt, query)}</p>
                <div class="search-result-tags">
                    ${post.tags.map(tag => `<span class="search-result-tag">${tag}</span>`).join('')}
                </div>
            </article>
        `).join('')}
    `;
    
    container.innerHTML = html;
}

// ê²€ìƒ‰ì–´ í•˜ì´ë¼ì´íŒ…
function highlightText(text, query) {
    if (!query.trim()) return text;
    
    const keywords = query.split(' ').filter(k => k.length > 0);
    let result = text;
    
    keywords.forEach(keyword => {
        const regex = new RegExp(`(${keyword})`, 'gi');
        result = result.replace(regex, '<mark>$1</mark>');
    });
    
    return result;
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const searchButton = document.getElementById('search-button');
    
    // URLì—ì„œ ê²€ìƒ‰ì–´ ê°€ì ¸ì™€ì„œ ìë™ ê²€ìƒ‰
    const initialQuery = getSearchQuery();
    if (initialQuery) {
        searchInput.value = initialQuery;
        performSearch(initialQuery);
    }
    
    // ê²€ìƒ‰ ì´ë²¤íŠ¸
    searchInput.addEventListener('input', function() {
        const query = this.value;
        const url = new URL(window.location);
        url.searchParams.set('q', query);
        window.history.replaceState({}, '', url);
        performSearch(query);
    });
    
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch(this.value);
        }
    });
    
    searchButton.addEventListener('click', function() {
        performSearch(searchInput.value);
    });
});
</script>